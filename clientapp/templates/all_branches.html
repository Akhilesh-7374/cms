{% extends "home.html" %}
{% block title %}All Branches | Client Monitoring System{% endblock %}

{% block content %}
  <h2 style="text-align: center; margin-top: 40px;">All Branches</h2>

  <form method="get" action="{% url 'all_branches' %}" style="text-align: center; margin-bottom: 30px;">
    <label for="client"><strong>Select Client:</strong></label>
    <select name="client" id="client">
      <option value="all" {% if selected_client_id == "all" or not selected_client_id %}selected{% endif %}>All Branches</option>
      {% for client in clients %}
        <option value="{{ client.id }}" {% if client.id|stringformat:"s" == selected_client_id %}selected{% endif %}>
          {{ client.client_name }}
        </option>
      {% endfor %}
    </select>
    <button type="submit" style="padding: 6px 12px; margin-left: 10px;">View Branches</button>
  </form>

  {% if branches %}
    <table border="1" cellpadding="8" cellspacing="1" align="center" width="95%">
    <thead style="background-color:orange">
        <tr>
          <th>ID</th>
          <th>Client Name</th>
          <th>Branch Name</th>
          <th>Branch Code</th>
          <th>Contact Name</th>
          <th>Contact Number</th>
          <th>Address</th>
          <th>Weblink</th>
          <th>No. of Students</th>
          <th>Description</th>
          <th>Edit</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody>
        {% for branch in branches %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ branch.client.client_name }}</td>
          <td>{{ branch.branch_name }}</td>
          <td>{{ branch.branch_code }}</td>
          <td>{{ branch.contact_name }}</td>
          <td>{{ branch.contact_number }}</td>
          <td>{{ branch.address }}</td>
          <td>
            {% if branch.weblink %}
              <a href="{{ branch.weblink }}" target="_blank">{{ branch.weblink }}</a>
            {% else %}
              N/A
            {% endif %}
          </td>
          <td>{{ branch.number_of_students|default:"-" }}</td>
          <td>{{ branch.description|default:"-" }}</td>
          <td>
            <a href="{% url 'edit_branch' branch.id %}"><button type="button">Edit</button></a>
          </td>
          <td>
            <form method="post" action="{% url 'delete_branch' branch.id %}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this branch?');">
              {% csrf_token %}
              <button type="submit">Delete</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p style="text-align:center; margin-top: 30px;">No branches found for this client.</p>
  {% endif %}

  <br><br>
  <center>
    <a href="/clientapp/allclients/"><button type="button">Back</button></a>
  </center>
{% endblock %}
